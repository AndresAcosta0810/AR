<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-aframe.prod.js"></script>
</head>
<script>
    AFRAME.registerComponent('occlusion', {

        schema: {
            type: 'boolean', default: true
        },

        init: function () {
            this.setOcclusion(this.data);
        },

        update: function () {
            console.log(this.data);
            this.setOcclusion(this.data);
        },

        setOcclusion: function (val) {

            // Create occlusion material
            const material = new THREE.MeshStandardMaterial({
                colorWrite: !val,
                color: 0xff0000,
            });

            // Apply material to object and all children
            this.el.object3D.traverse((obj) => {
                obj.material = material;
            });
        }

    });

</script>

<script>

    AFRAME.registerComponent('shadowonly', {
        init: function () {
            // Create shadow material
            const material = new THREE.ShadowMaterial({
                opacity: 0.5,
            });

            // Apply material to object and all children
            this.el.object3D.traverse((obj) => {
                obj.material = material;
            });
        }
    });

</script>

<body>    

    <a-scene mindar-image="imageTargetSrc: naranjas.mind;"
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">

        <a-assets>
            <a-asset-item id="box" src="./BOX/cardboard_box_01_4k.gltf"></a-asset-item>
            <a-asset-item id="tv" src="./TV/Television_01_4k.gltf"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- GEOMETRÍA CAJAS -->

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>     
        
        <a-entity mindar-image-target="targetIndex: 0">

            <a-box position="8 -4.2 -7" occlusion="" material="" scale="1 2 1"></a-box>
            <a-entity shadow="" gltf-model="./TV/Television_01_4k.gltf" position="0 -4 -7" material="" scale="5 5 5"></a-entity>
            <a-entity shadow="" gltf-model="./BOX/cardboard_box_01_4k.gltf" position="8 -4 -7" material="" scale="5 5 5"></a-entity>
        

            <!-- LUCES --> 

            <a-entity id="luz_blanca1" position="-0.06131 5.07338 0.78559" rotation="-37 -20 0"
                light="type: spot; castShadow: true; intensity: 0.7; color: #f3f3f2">
            </a-entity>

            <a-entity id="luz_blanca" position="-0.01236 4.19129 0.64973" light="intensity: 0.9; color: white">
            </a-entity>

            <a-entity id="luz_ambiente" light="type: ambient; intensity: 0.36">
            </a-entity>

            <!-- PLANOS SOMBRAS -->

            <a-plane id="suelo" shadow="cast: false" shadowonly="" material="color: white; opacity: 0.5" scale="6 6 6"
                position="-0.02476 0 -2.56392" rotation="-90 10 0" geometry="">
            </a-plane>

            <a-plane id="pared" shadow="cast: false" shadowonly="" material="color: white; opacity: 0.5" scale="3 3 3"
                position="-1.74 1.5 -7.27179" rotation="0 10 0" geometry="">
            </a-plane>
        </a-entity>
        
    </a-scene>
</body>

</html>